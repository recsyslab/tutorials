# キャンバスへの描画

ページが読み込まれたときに，キャンバスにタイトル画像が描画されるようにしてみましょう．

まずは，画像ファイルを用意します．`static`ディレクトリに`images`ディレクトリを作成してください．つまり，下記のディレクトリを用意します．

`static/images/`

画像ファイルはこのディレクトリの中に置くことにします．本チュートリアル用に，タイトル画像[`title.bmp`](images/title.bmp)と背景画像[`background.bmp`](images/background.bmp)を用意しました．それぞれダウンロードし，上記のディレクトリに置いてください．

つづいて，`templates/touch/index.html`の`{# --- files --- #}`の部分に下記のコードを追加してください．

リスト1: `templates/touch/index.html`
```html
...（略）...
    <!-- 以下を追加11 -->
    {# --- files --- #}
    <script>
        let titleSrc = "{% static 'images/title.bmp' %}"
        let backgroundSrc = "{% static 'images/background.bmp' %}"
    </script>
...（略）...
```

`static/js/main.js`に下記のコードを記述してください．
 
リスト2: `static/js/main.js`
```js
/**
 * **** **** **** **** **** **** **** ****
 * グローバル変数
 * **** **** **** **** **** **** **** ****
 */
let canvas = null;              // キャンバス
let context = null;             // 描画用コンテキスト
let titleImage = null;          // タイトル画像Imageオブジェクト
let backgroundImage = null;     // 背景画像Imageオブジェクト
/**
 * **** **** **** **** **** **** **** ****
 * メイン処理
 * **** **** **** **** **** **** **** ****
 */
/**
 * 全体の初期化処理
 */
function init() {
    // キャンバス要素の取得
    canvas = document.getElementById("a_canvas");
    // 描画用コンテキストの取得
    context = canvas.getContext("2d");

    // Imageオブジェクトの生成
    titleImage = new Image();
    titleImage.src = titleSrc;
    titleImage.onload = function() {
        console.log(titleImage.src + " : ロード完了");
        drawTitle();
    }

    backgroundImage = new Image();
    backgroundImage.src = backgroundSrc;
    backgroundImage.onload = function() {
        console.log(backgroundImage.src + " : ロード完了");
    }
}
/**
 * **** **** **** **** **** **** **** ****
 * イベント関連
 * **** **** **** **** **** **** **** ****
 */
/**
 * ページ読込み
 */
$(function() {
    // 全体の初期化処理
    init();
});
/**
 * **** **** **** **** **** **** **** ****
 * ビュー関連
 * **** **** **** **** **** **** **** ****
 */
/**
 * タイトル画面の描画
 */
function drawTitle() {
    context.drawImage(titleImage, 0, 0);
}
```

ブラウザで下記のURLにアクセスしてみましょう．

`http://localhost:8000/touch/`

すると，「Touch, touch, touch!」と書かれたタイトル画像が表示されました．

それでは，ページが読み込まれてから，タイトル画像が描画されるまでの流れを追ってみましょう．まず，このページ（`index.html`）が読み込まれたとき，46行目の`$(function() {...})`が呼ばれます．ここで，`init()`関数を呼び出しています．

`init()`関数ではキャンバス要素を取得しています．キャンバス要素の取得には，`document.getElementById()`メソッドを用います．ここでは，引数に`"a_canvas"`を与えることで，`index.html`で作成したキャンバスを指定しています．取得したキャンバス要素をグローバル変数`canvas`に格納しています．

つづいて，キャンバス要素から描画用のコンテキストを取得しています．コンテキストの取得には，`canvas.getContext()`メソッドを用います．引数の`"2d"`は，2次元（2D）描画用のメソッドを取得するという意味です．取得したコンテキストをグローバル変数`context`に格納しています．

25-26行目では，タイトル画像のImageオブジェクトを生成しています．`titleImage = newImage()`とすることで，Imageオブジェクトを生成し，`titleImage.src`に`index.html`で定義した`titleSrc`をセットすることで，タイトル画像ファイル`images/title.bmp`を読み込んでいます．画像の読込みが完了すると，`titleImage.onload`に指定した関数が呼ばれます．つまり，28-29行目が実行されます．ここでは，明示的にコンソールに「ロード完了」と出力し，`drawTitle()`関数を呼び出しています．`drawTitle()`関数では，先に取得した描画用コンテキスト`context`を用いて，タイトル画像を描画しています．ここで，画像の読込みが完了する前に，画像を描画しようとすると正しく表示されない可能性がありますので注意してください．

32-36行目では，同様に，背景画像のImageオブジェクトを生成しています．これについては，今回は読込みだけで描画はしていません．
