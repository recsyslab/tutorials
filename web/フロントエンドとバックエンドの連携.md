# フロントエンドとバックエンドの連携

## フロントエンドの実装

### VSCodeの起動
```bash
$ cd ~/dev/app/frontend/
$ code .
```

### hello/page.tsxの作成
`frontend/app/`ディレクトリに`hello`ディレクトリを作成する。
- `~/dev/app/frontend/app/hello/`

作成した`hello/`ディレクトリに`page.tsx`を作成し、下記コードを記述する。

`~/dev/app/frontend/app/hello/page.tsx`
```tsx
export default function Page() {
    return <h1>Hello, Next.js!</h1>
}
```

```bash
$ cd ~/dev/app/frontend/
$ yarn dev
```

ブラウザで http://localhost:3000/hello にアクセスし、「Hello, Next.js」が表示されれば成功。

### Next.js上でのAPIの用意
`frontend/`ディレクトリに`pages/api/`ディレクトリを作成する。
- `~/dev/app/frontend/pages/api/`

作成した`api/`ディレクトリに`hello.ts`を作成し、下記コードを記述する。

`~/dev/app/frontend/pages/api/hello.ts`
```ts
import type { NextApiRequest, NextApiResponse } from 'next'

type Data = {
    name: string
}

export default function handler(
    req: NextApiRequest,
    res: NextApiResponse<Data>
) {
    res.status(200).json({ name: 'John Doe' })
}
```

ブラウザで http://localhost:3000/api/hello にアクセスし、「{"name":"John Doe"}」が表示されれば成功。

※うまく表示されない場合は、サーバを再起動してみる。

### Next.js上でのAPI通信
`frontend/app/`ディレクトリに`hello_frontend_fetch/`ディレクトリを作成する。
- `~/dev/app/frontend/app/hello_frontend_fetch/`

作成した`hello_frontend_fetch/`ディレクトリに`page.tsx`を作成し、下記コードを記述する。

`~/dev/app/frontend/app/hello_frontend_fetch/page.tsx`
```tsx
'use client'

import { useState, useEffect } from 'react'

export default function Page() {
    const [data, setData] = useState({ name: '' })

    useEffect(() => {
        fetch('/api/hello')
            .then((res) => res.json())
            .then((data) => {
                setData(data)
            })

    }, [])
    return <div>hello {data.name}!</div>
}
```

ブラウザで http://localhost:3000/hello_frontend_fetch にアクセスし、「hello John Doe!」が表示されれば成功。

※うまく表示されない場合は、サーバを再起動してみる。

### axiosを使った連携
`frontend/app/`ディレクトリに`hello_frontend/`ディレクトリを作成する。
- `~/dev/app/frontend/app/hello_frontend/`

作成した`hello_frontend/`ディレクトリに`page.tsx`を作成し、下記コードを記述する。

`~/dev/app/frontend/app/hello_frontend/page.tsx`
```tsx
'use client'

import axios from 'axios'
import { useEffect, useState } from 'react'

export default function Page() {
    const [data, setData] = useState({ name: '' })

    useEffect(() => {
        axios.get('/api/hello')
            .then((res) => res.data)
            .then((data) => {
                setData(data)
            })
    }, [])

    return <div>hello {data.name}!</div>
}
```

ブラウザで http://localhost:3000/hello_frontend にアクセスし、「hello John Doe!」が表示されれば成功。

※うまく表示されない場合は、サーバを再起動してみる。

## バックエンドの実装

### VSCodeの起動
```bash
$ cd ~/dev/app/backend/
$ code .
```

### helloアプリケーションの作成
```bash
$ mkdir ~/dev/app/backend/api/
$ cd ~/dev/app/backend/api/
$ source ~/venv/rsl-web/bin/activate
(rsl-web) $ django-admin startapp hello
```

### DjangoでのAPIへのルーティングの設定

`config/urls.py`を下記のように編集する。

`~/dev/app/backend/config/urls.py`
```py
...（略）...
from django.contrib import admin
from django.urls import path, include  # includeを追加

urlpatterns = [
    path("admin/", admin.site.urls),
    path('api/hello/', include('api.hello.urls')),        # 追加
]
```

`api/hello/ursl.py`ディレクトリに`urls.py`を作成し、下記コードを記述する。
```py
from django.urls import path
from . import views

urlpatterns = [
    path('backend/', views.Backend.as_view())
]
```

